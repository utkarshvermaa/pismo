# txn-routine
A go app to mimic transactions and accounts operations

## Requirements
- install "make" to run the Makefile (`brew install make` if on Mac)
- a free port (**default**: `8080`, can be configured in `Dockerfile` / `docker-compose.yml`)
- docker compose and docker
- go version >= 1.22 to run tests locally (run `go version` to check version)

## Project Structure
```
.
├── cmd (application startup logic)
├── data
│   └── mysql
│       ├── <auto-generated mysql files>
├── internal
│   ├── accounts (account related business logic)
│   │   └── payload (account related reques)
│   ├── domains (domain contains corresponding payload structs, which will flow internally in the system)
│   └── transactions (transactions related business logic)
│       └── payload (transactions related request)
├── migrations (migration files and migration logic)
│   ├── down (down migration files)
│   └── up (down migration files)
├── pkg (standard package files)
│   ├── database 
│   ├── env
│   ├── errors
│   ├── logger
│   └── time
├── repository (standard package files)
│   ├── accounts (db repository for accounts)
│   │   └── mocks (mock file for accounts)
│   └── transactions (db repository for transactions)
│       └── mocks (mock file for transactions)
└── server (router and handler)
```

## Implementation
The amount in transactions is intentionally kept as integer instead of float. We plan to keep it so to avoid any floating point errors. The amounts would be kept in lowest possible denominations, i.e. Paisa for INR (100 paisa = ₹1), Centavos for Real (100 Centavos = 1 Real).

## Setup
1. setup the project in `$GOPATH/src/github.com/projects/sys-des/txn-routine`
2. clone the application
3. in the root directory, run `docker-compose up --build`

Note: In case compose fails while setting up the DB

1. retry with `docker-compose up --build`. This works because in the first run the msql files are populated and in the subsequent run the application can connect to it successfully.
2. try increasing the `interval` and `timeout` of db healthcheck in `docker-compose.yml`. Sometimes, the db can take long time to initialise.


## Endpoints

1. ping
```
curl --location 'localhost:8080/ping'
```

    Expected Response:
```
{
    "message": "pong"
}
```
2. create account
```
curl --location 'localhost:8080/accounts' \
--header 'Content-Type: application/json' \
--data '{
    "document_number": "12345678900"
}'
```
    Expected Response:
```
{
    "id": 1,
    "message": "account created"
}
```
3. get account
```
curl --location 'localhost:8080/accounts/1'
```
    Expected Response:
```
{
    "id": 1,
    "document_number": "12345678900"
}
```
4. create transaction
```
curl --location 'localhost:8080/transactions' \
--header 'Content-Type: application/json' \
--data '{
    "account_id": 1,
    "operation_type_id": 3,
    "amount": 5
}'
```
    Expected Response:
```
{
    "id": 1,
    "message": "transaction created"
}
```

## Testing
> This project includes unit tests and leverages mocks wherever necessary.
1. Run `make test`
